<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= poster.name ?> - Filmytea</title>
    <?!= include('style'); ?>
    <link rel="preconnect" href="https://res.cloudinary.com">
    <link rel="dns-prefetch" href="//res.cloudinary.com">
    <link rel="preload" href="<?= poster.image_url.replace('/upload/', '/upload/w_600,h_800,c_fill,f_auto,q_auto/') ?>" as="image">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="?">Filmytea</a></h1>
            <nav class="header-nav">
                <a href="?page=posters" class="nav-link">Posters</a>
                <a href="?page=cart" class="nav-link cart-link">
                    Cart (<span id="cart-count">0</span>)
                </a>
            </nav>
        </div>
    </header>

    <main class="main poster-detail-main">
        <div class="container">
            <div class="poster-detail">
                <div class="poster-detail-image">
                    <img src="<?= poster.image_url.replace('/upload/', '/upload/w_600,h_800,c_fill,f_auto,q_auto/') ?>" 
                         alt="<?= poster.name ?>"
                         loading="eager"
                         decoding="async"
                         width="600"
                         height="800">
                </div>
                
                <div class="poster-detail-info">
                    <h1 class="poster-title"><?= poster.name ?></h1>
                    
                    <div class="poster-options">
                        <div class="price-section">
                            <span id="selectedPrice">₹ 99.00</span>
                        </div>
                        
                        <div class="size-section">
                            <label class="section-label">Size:</label>
                            <div class="toggle-group">
                                <button class="toggle-btn active" data-size="A4">A4</button>
                                <button class="toggle-btn" data-size="A3">A3</button>
                            </div>
                        </div>
                        
                        <div class="frame-section">
                            <label class="section-label">Frame:</label>
                            <div class="toggle-group">
                                <button class="toggle-btn active" data-frame="no">No Frame</button>
                                <button class="toggle-btn" data-frame="black">Black Frame</button>
                                <button class="toggle-btn" data-frame="white">White Frame</button>
                            </div>
                        </div>
                        
                        <div class="get-now-container">
                            <button id="addToCartBtn" class="btn btn-primary btn-large">
                                Add to Cart
                            </button>
                            <button id="getNowBtn" class="btn btn-payment btn-large">
                                Buy Now
                            </button>
                        </div>
                    </div>
                    
                    <div class="back-link">
                        <a href="?page=posters" class="btn btn-secondary">← Back to Posters</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Filmytea. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const poster = {
            id: '<?= poster.id ?>',
            name: '<?= poster.name ?>',
            image_url: '<?= poster.image_url ?>'
        };
        
        const pricing = {
            'A4': { 'no': 99, 'black': 299, 'white': 299 },
            'A3': { 'no': 129, 'black': 399, 'white': 399 }
        };
        
        let selectedSize = 'A4';
        let selectedFrame = 'no';
        
        function updatePrice() {
            const price = pricing[selectedSize][selectedFrame];
            document.getElementById('selectedPrice').textContent = '₹ ' + price + '.00';
        }
        
        // Handle size toggle
        document.querySelectorAll('[data-size]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-size]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedSize = this.dataset.size;
                updatePrice();
            });
        });
        
        // Handle frame toggle
        document.querySelectorAll('[data-frame]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-frame]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedFrame = this.dataset.frame;
                updatePrice();
            });
        });
        
        // Initialize default selection
        updatePrice();
        
        // Add to Cart functionality
        document.getElementById('addToCartBtn').addEventListener('click', function() {
            cart.addItem(poster, selectedSize, selectedFrame);
        });
        
        // Buy Now functionality - add to cart and redirect to checkout
        document.getElementById('getNowBtn').addEventListener('click', function() {
            cart.addItem(poster, selectedSize, selectedFrame);
            window.location.href = '?page=checkout';
        });
        
        // Optimize image loading
        const detailImg = document.querySelector('.poster-detail-image img');
        if (detailImg) {
            detailImg.addEventListener('load', function() {
                this.style.opacity = '1';
            });
            
            detailImg.addEventListener('error', function() {
                this.style.opacity = '0.5';
                this.alt = 'Image failed to load';
            });
        }
    </script>
    <?!= include('cart_js'); ?>
</body>
</html>