<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Filmytea</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="{{ url_for('index') }}">Filmytea</a></h1>
            <nav class="header-nav">
                <a href="{{ url_for('posters') }}" class="nav-link">Posters</a>
                <a href="{{ url_for('cart') }}" class="nav-link cart-link">
                    Cart (<span id="cart-count">0</span>)
                </a>
            </nav>
        </div>
    </header>
<main class="main checkout-main">
    <div class="container">
        <section class="checkout-hero">
            <h2>Please enter order details:</h2>
        </section>

        <div class="checkout-content">
            <div class="checkout-form-section">
                <form method="POST" action="{{ url_for('process_order') }}" class="checkout-form" id="order-form">


                    <div class="form-group">
                        <label for="customer_name">Customer Name:</label>
                        <input type="text" id="customer_name" name="customer_name" required placeholder="Customer Name">
                    </div>

                    <h4>Shipping Address:</h4>
                    
                    <div class="form-group">
                        <label for="address">Address:</label>
                        <textarea id="address" name="address" required placeholder="Complete Address" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="pincode">Pincode:</label>
                        <input type="text" id="pincode" name="pincode" required placeholder="Pincode">
                    </div>

                    <div class="form-group">
                        <label for="city">City:</label>
                        <input type="text" id="city" name="city" required placeholder="City">
                    </div>

                    <div class="form-group">
                        <label for="state">State:</label>
                        <input type="text" id="state" name="state" required placeholder="State">
                    </div>

                    <div class="form-group">
                        <label for="phone_number">Phone Number:</label>
                        <input type="tel" id="phone_number" name="phone_number" required placeholder="Phone Number">
                    </div>

                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required placeholder="Email">
                    </div>

                    <div class="form-group">
                        <label>Payment Method:</label>
                        <div class="payment-methods">
                            <label class="payment-option">
                                <input type="radio" name="payment_method" value="online" required>
                                <span>Pay Online (Cards, UPI, Net Banking)</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="payment_method" value="cod" required>
                                <span>Cash on Delivery</span>
                            </label>
                        </div>
                    </div>

                    <div class="payment-buttons">
                        <button type="button" id="pay-online-btn" class="btn btn-success btn-large" style="display: none;">
                            Pay Now ₹<span id="pay-amount">0</span>
                        </button>
                        <button type="submit" id="cod-btn" class="btn btn-primary btn-large" style="display: none;">
                            Place COD Order
                        </button>
                    </div>
                </form>
            </div>

            <div class="order-summary">
                <h3>Cart Items</h3>
                <div id="checkout-items"></div>
                <div class="order-total">
                    <strong>Total: ₹<span id="checkout-total">0</span></strong>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cart = JSON.parse(localStorage.getItem('filmytea_cart')) || [];
    const checkoutItems = document.getElementById('checkout-items');
    const checkoutTotal = document.getElementById('checkout-total');
    const payAmount = document.getElementById('pay-amount');
    const payOnlineBtn = document.getElementById('pay-online-btn');
    const codBtn = document.getElementById('cod-btn');
    const form = document.getElementById('order-form');
    
    let total = 0;
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const itemDiv = document.createElement('div');
        itemDiv.className = 'checkout-item';
        itemDiv.innerHTML = `
            <div class="checkout-item-info">
                <h4>${item.name}</h4>
                <p>Size: ${item.size}, Frame: ${item.frame}</p>
                <p>Quantity: ${item.quantity} × ₹${item.price} = ₹${itemTotal}</p>
            </div>
        `;
        checkoutItems.appendChild(itemDiv);
    });
    
    checkoutTotal.textContent = total;
    payAmount.textContent = total;
    
    if (cart.length === 0) {
        checkoutItems.innerHTML = '<p>Your cart is empty.</p>';
        payOnlineBtn.disabled = true;
        codBtn.disabled = true;
        return;
    }
    
    // Handle payment method selection
    const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
    paymentMethods.forEach(method => {
        method.addEventListener('change', function() {
            if (this.value === 'online') {
                payOnlineBtn.style.display = 'inline-block';
                codBtn.style.display = 'none';
            } else if (this.value === 'cod') {
                payOnlineBtn.style.display = 'none';
                codBtn.style.display = 'inline-block';
            }
        });
    });
    
    // Handle online payment
    payOnlineBtn.addEventListener('click', function() {
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        // Create hidden form for payment
        const paymentForm = document.createElement('form');
        paymentForm.method = 'POST';
        paymentForm.action = '/create-payment';
        
        // Add all form data
        const formData = new FormData(form);
        formData.append('cart_total', total);
        formData.append('cart_items', JSON.stringify(cart));
        
        for (let [key, value] of formData.entries()) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            paymentForm.appendChild(input);
        }
        
        document.body.appendChild(paymentForm);
        paymentForm.submit();
    });
    
    // Handle COD order (existing behavior)
    form.addEventListener('submit', function(e) {
        const selectedPayment = document.querySelector('input[name="payment_method"]:checked');
        if (selectedPayment && selectedPayment.value === 'online') {
            e.preventDefault(); // Prevent form submission for online payment
            return;
        }
        
        // For COD, add cash_on_delivery field
        const codInput = document.createElement('input');
        codInput.type = 'hidden';
        codInput.name = 'cash_on_delivery';
        codInput.value = 'Yes';
        form.appendChild(codInput);
    });
});
</script>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Filmytea. All rights reserved.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='cart.js') }}"></script>
</body>
</html>