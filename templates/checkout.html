{% extends "base.html" %}
{% block title %}Checkout - Filmytea{% endblock %}
{% block content %}
<main class="main checkout-main">
    <div class="container">
        <section class="checkout-hero">
            <h2>Checkout</h2>
        </section>

        <div class="checkout-content">
            <div class="checkout-form-section">
                <h3>Order Details</h3>
                <form method="POST" action="{{ url_for('process_order') }}" class="checkout-form">
                    <div class="form-group">
                        <label for="reference_number">Reference Number</label>
                        <input type="text" id="reference_number" name="reference_number" required 
                               value="ORD{{ range(10000, 99999) | random }}">
                    </div>

                    <div class="form-group">
                        <label for="retail_price">Total Amount</label>
                        <input type="text" id="retail_price" name="retail_price" required readonly>
                    </div>

                    <div class="form-group">
                        <label for="customer_name">Customer Name</label>
                        <input type="text" id="customer_name" name="customer_name" required>
                    </div>

                    <h4>Shipping Address</h4>
                    
                    <div class="form-group">
                        <label for="address_line1">Address Line 1</label>
                        <input type="text" id="address_line1" name="address_line1" required>
                    </div>

                    <div class="form-group">
                        <label for="address_line2">Address Line 2</label>
                        <input type="text" id="address_line2" name="address_line2">
                    </div>

                    <div class="form-group">
                        <label for="address_line3">Address Line 3 / Landmark</label>
                        <input type="text" id="address_line3" name="address_line3">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="pincode">Pincode</label>
                            <input type="text" id="pincode" name="pincode" required>
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" required>
                        </div>
                        <div class="form-group">
                            <label for="state">State</label>
                            <input type="text" id="state" name="state" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone_number">Phone Number</label>
                            <input type="tel" id="phone_number" name="phone_number" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cash_on_delivery">Payment Method</label>
                        <select id="cash_on_delivery" name="cash_on_delivery" required>
                            <option value="Yes">Cash on Delivery</option>
                            <option value="No">Online Payment</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">Place Order</button>
                </form>
            </div>

            <div class="order-summary">
                <h3>Order Summary</h3>
                <div id="checkout-items"></div>
                <div class="order-total">
                    <strong>Total: ₹<span id="checkout-total">0</span></strong>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const checkoutItems = document.getElementById('checkout-items');
    const checkoutTotal = document.getElementById('checkout-total');
    const retailPriceInput = document.getElementById('retail_price');
    
    let total = 0;
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const itemDiv = document.createElement('div');
        itemDiv.className = 'checkout-item';
        itemDiv.innerHTML = `
            <div class="checkout-item-info">
                <h4>${item.name}</h4>
                <p>Size: ${item.size}, Frame: ${item.frame}</p>
                <p>Quantity: ${item.quantity} × ₹${item.price} = ₹${itemTotal}</p>
            </div>
        `;
        checkoutItems.appendChild(itemDiv);
    });
    
    checkoutTotal.textContent = total;
    retailPriceInput.value = '₹' + total;
    
    if (cart.length === 0) {
        checkoutItems.innerHTML = '<p>Your cart is empty.</p>';
        document.querySelector('.btn-primary').disabled = true;
    }
});
</script>
{% endblock %}