{% extends "base.html" %}

{% block title %}{{ poster.name }} Poster - Filmytea{% endblock %}

{% block description %}{{ poster.name }} movie poster. High-quality print available in A4 and A3 sizes with custom framing options. Order now for fast delivery.{% endblock %}

{% block keywords %}{{ poster.name }}, movie poster, film print, {{ poster.name }} art, poster print{% endblock %}

{% block og_title %}{{ poster.name }} Movie Poster - Filmytea{% endblock %}
{% block og_description %}Premium {{ poster.name }} poster available in multiple sizes with framing options.{% endblock %}
{% block og_image %}{{ poster.image_url }}{% endblock %}

{% block preload %}
<link rel="preload" href="{{ poster.image_url.replace('/upload/', '/upload/w_600,h_800,c_fill,f_auto,q_auto/') }}" as="image">
{% endblock %}

{% block main_class %}poster-detail-main{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="Breadcrumb" class="breadcrumb">
        <a href="{{ url_for('index') }}">Home</a> → 
        <a href="{{ url_for('posters') }}">Posters</a> → 
        <span aria-current="page">{{ poster.name }}</span>
    </nav>
    
    <article class="poster-detail-container">
        <div class="poster-detail-layout">
            <!-- Left Column: Poster Details -->
            <div class="poster-details-column">
                <div class="poster-detail-info">
                    <h1 class="poster-title">{{ poster.name }}</h1>
                    
                    <div class="price-display">
                        <span id="selectedPrice" class="current-price">₹ 129.00</span>
                    </div>
                    
                    <div class="poster-options">
                        <div class="option-group size-section">
                            <label class="option-label">Size:</label>
                            <div class="toggle-group">
                                <button class="toggle-btn active" data-size="A4">A4</button>
                                <button class="toggle-btn" data-size="A3">A3</button>
                            </div>
                        </div>
                        
                        <div class="option-group frame-section">
                            <label class="option-label">Frame:</label>
                            <div class="toggle-group">
                                <button class="toggle-btn active" data-frame="no">No Frame</button>
                                <button class="toggle-btn" data-frame="black">Black Frame</button>
                                <button class="toggle-btn" data-frame="white">White Frame</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="addToCartBtn" class="btn btn-add-cart">
                            Add to Cart
                        </button>
                        <button id="getNowBtn" class="btn btn-buy-now" onclick="addToCartAndCheckout()">
                            Buy Now
                        </button>
                    </div>
                    
                    <div class="back-navigation">
                        <a href="{{ url_for('posters') }}" class="btn btn-back">← Back to Posters</a>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Poster Image -->
            <div class="poster-image-column">
                <div class="poster-detail-image">
                    <img src="{{ poster.image_url.replace('/upload/', '/upload/w_600,f_auto,q_auto/') }}" 
                         alt="{{ poster.name }} movie poster"
                         loading="eager"
                         decoding="async">
                </div>
            </div>
        </div>
    </article>
</div>
{% endblock %}

{% block scripts %}
<script>
        const pricing = {
            'A4': { 'no': 129, 'black': 399, 'white': 399 },
            'A3': { 'no': 159, 'black': 499, 'white': 499 }
        };
        
        let selectedSize = 'A4';
        let selectedFrame = 'no';
        
        function updatePrice() {
            const price = pricing[selectedSize][selectedFrame];
            document.getElementById('selectedPrice').textContent = '₹ ' + price + '.00';
        }
        
        // Handle size toggle
        document.querySelectorAll('[data-size]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-size]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedSize = this.dataset.size;
                updatePrice();
            });
        });
        
        // Handle frame toggle
        document.querySelectorAll('[data-frame]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-frame]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedFrame = this.dataset.frame;
                updatePrice();
            });
        });
        
        // Initialize default selection
        updatePrice();
        
        // Add to Cart functionality
        document.getElementById('addToCartBtn').addEventListener('click', function() {
            const poster = {
                id: '{{ poster.id }}',
                name: '{{ poster.name }}',
                image_url: '{{ poster.image_url }}'
            };
            
            cart.addItem(poster, selectedSize, selectedFrame);
        });
        
        // Buy Now functionality - add to cart and redirect to checkout
        function addToCartAndCheckout() {
            const poster = {
                id: '{{ poster.id }}',
                name: '{{ poster.name }}',
                image_url: '{{ poster.image_url }}'
            };
            
            cart.addItem(poster, selectedSize, selectedFrame);
            // Redirect to checkout page in same window
            window.location.href = '{{ url_for("checkout") }}';
        }
        
        // Optimize image loading
        const detailImg = document.querySelector('.poster-detail-image img');
        if (detailImg) {
            detailImg.addEventListener('load', function() {
                this.style.opacity = '1';
            });
            
            detailImg.addEventListener('error', function() {
                this.style.opacity = '0.5';
                this.alt = 'Image failed to load';
            });
        }
</script>
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "{{ poster.name }}",
    "image": "{{ poster.image_url }}",
    "description": "{{ poster.name }} movie poster available in A4 and A3 sizes",
    "brand": {
        "@type": "Brand",
        "name": "Filmytea"
    },
    "offers": {
        "@type": "AggregateOffer",
        "lowPrice": "129",
        "highPrice": "499",
        "priceCurrency": "INR",
        "availability": "https://schema.org/InStock"
    }
}
</script>
{% endblock %}